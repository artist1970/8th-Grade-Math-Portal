<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>8th Grade Math Portal</title>

<link rel="stylesheet" href="styles.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module" src="scripts/portal.js"></script>
</head>
<body class="dark">

<header>
  <h1>üåå 8th Grade Math Portal</h1>
  <p class="tagline">Pre-Algebra ‚Üí Problem Solving | Track your progress!</p>
</header>

<main>
  <!-- Student Panel -->
  <section id="studentPanel" class="card">
    <h2>Student</h2>
    <input id="studentName" placeholder="Enter your name" />
    <label for="subjectSelect">Choose a Chapter:</label>
    <select id="subjectSelect">
      <option value="">--Select Chapter--</option>
      <option value="prealgebraTests">Pre-Algebra</option>
      <option value="algebraTests">Algebra</option>
      <option value="geometryTests">Geometry</option>
      <option value="probabilityTests">Probability</option>
      <option value="problemSolvingTests">Problem Solving</option>
    </select>
    <button id="startBtn">Start Portal</button>
  </section>

  <!-- Mission Panel -->
  <section id="missionPanel" class="card" style="display:none;">
    <h2 id="missionTitle">Chapter Test</h2>
    <div id="questionContainer"></div>
    <div style="margin-top:12px;">
      <button id="prevQuestionBtn">Previous</button>
      <button id="nextQuestionBtn">Next</button>
      <button id="submitMissionBtn">Submit Mission</button>
    </div>
    <div id="feedback" style="margin-top:12px;font-weight:bold;"></div>
    <div id="scoreDisplay" style="margin-top:8px;">Score: 0</div>
  </section>

  <!-- Chart Panel -->
  <section id="chartPanel" class="card" style="display:none;">
    <h2>Weekly Mission Progress</h2>
    <canvas id="progressChart" width="400" height="220"></canvas>
  </section>

  <!-- Export Panel -->
  <section id="exportPanel" class="card">
    <h2>Export Data</h2>
    <button id="exportBtn">Download CSV</button>
  </section>
</main>

<footer>
  <p>¬© 2025 DeepSpace Academy | 8th Grade Math Portal</p>
</footer>

<script type="module">
  let currentIndex = 0;
  let currentTest = [];
  let score = 0;

  const studentNameInput = document.getElementById('studentName');
  const subjectSelect = document.getElementById('subjectSelect');
  const startBtn = document.getElementById('startBtn');
  const missionPanel = document.getElementById('missionPanel');
  const questionContainer = document.getElementById('questionContainer');
  const prevQuestionBtn = document.getElementById('prevQuestionBtn');
  const nextQuestionBtn = document.getElementById('nextQuestionBtn');
  const submitMissionBtn = document.getElementById('submitMissionBtn');
  const feedbackDiv = document.getElementById('feedback');
  const scoreDisplay = document.getElementById('scoreDisplay');

  async function loadTest(subject) {
    // Dynamically import the selected test module
    const module = await import(`./scripts/modules/${subject}.js`);
    return module[subject];
  }

  function showQuestion() {
    const q = currentTest[currentIndex];
    if (!q) return;
    let html = `<p><strong>Q${currentIndex+1}:</strong> ${q.question}</p>`;
    html += `<div>`;
    for (const [key, val] of Object.entries(q.options)) {
      html += `<label><input type="radio" name="answer" value="${key}"> ${key}: ${val}</label><br>`;
    }
    html += `</div>`;
    questionContainer.innerHTML = html;
    feedbackDiv.textContent = '';
  }

  function checkAnswer() {
    const selected = document.querySelector('input[name="answer"]:checked');
    if (!selected) return alert('Please select an answer.');
    const userAnswer = selected.value;
    const correctAnswer = currentTest[currentIndex].answer;
    if (userAnswer === correctAnswer) {
      feedbackDiv.textContent = '‚úÖ Correct!';
      feedbackDiv.style.color = 'green';
      score++;
    } else {
      feedbackDiv.textContent = `‚ùå Incorrect. Correct: ${correctAnswer}`;
      feedbackDiv.style.color = 'red';
    }
    scoreDisplay.textContent = `Score: ${score}`;
  }

  function nextQuestion() {
    if (currentIndex < currentTest.length - 1) {
      currentIndex++;
      showQuestion();
    }
  }

  function prevQuestion() {
    if (currentIndex > 0) {
      currentIndex--;
      showQuestion();
    }
  }

  startBtn.addEventListener('click', async () => {
    if (!studentNameInput.value) return alert('Please enter your name.');
    if (!subjectSelect.value) return alert('Please select a chapter.');
    currentTest = await loadTest(subjectSelect.value);
    currentIndex = 0;
    score = 0;
    scoreDisplay.textContent = `Score: ${score}`;
    missionPanel.style.display = 'block';
    showQuestion();
  });

  nextQuestionBtn.addEventListener('click', nextQuestion);
  prevQuestionBtn.addEventListener('click', prevQuestion);
  submitMissionBtn.addEventListener('click', checkAnswer);
</script>

</body>
</html>
